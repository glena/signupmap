<!DOCTYPE html>
<html>
  <head>
    <title>Realtime Login Map</title>
    <style>
      html, body, #map-canvas {
        margin: 0;
        padding: 0;
        height: 600px;
        width: 1024px;
      }
    </style>
    <script src="https://js.pusher.com/2.2/pusher.min.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?libraries=geometry,visualization"></script>
    <script type="text/javascript">
    var map;

    function initialize() {

      var mapOptions = {
          zoom: 2,
          center: {lat: 0, lng: 0},
          styles: [{"featureType":"administrative.locality","elementType":"all","stylers":[{"hue":"#2c2e33"},{"saturation":7},{"lightness":19},{"visibility":"on"}]},{"featureType":"landscape","elementType":"all","stylers":[{"hue":"#ffffff"},{"saturation":-100},{"lightness":100},{"visibility":"simplified"}]},{"featureType":"poi","elementType":"all","stylers":[{"hue":"#ffffff"},{"saturation":-100},{"lightness":100},{"visibility":"off"}]},{"featureType":"road","elementType":"geometry","stylers":[{"hue":"#bbc0c4"},{"saturation":-93},{"lightness":31},{"visibility":"simplified"}]},{"featureType":"road","elementType":"labels","stylers":[{"hue":"#bbc0c4"},{"saturation":-93},{"lightness":31},{"visibility":"on"}]},{"featureType":"road.arterial","elementType":"labels","stylers":[{"hue":"#bbc0c4"},{"saturation":-93},{"lightness":-2},{"visibility":"simplified"}]},{"featureType":"road.local","elementType":"geometry","stylers":[{"hue":"#e9ebed"},{"saturation":-90},{"lightness":-8},{"visibility":"simplified"}]},{"featureType":"transit","elementType":"all","stylers":[{"hue":"#e9ebed"},{"saturation":10},{"lightness":69},{"visibility":"on"}]},{"featureType":"water","elementType":"all","stylers":[{"hue":"#e9ebed"},{"saturation":-78},{"lightness":67},{"visibility":"simplified"}]}]
      };


      map = new google.maps.Map(document.getElementById('map-canvas'),
          mapOptions);

      Pusher.log = function(message) {
        console.log(message);
      };

      var pusher = new Pusher('54da1f9bddbf14929983');
      var channel = pusher.subscribe('world_map');

      var points = [];

      heatmap = new google.maps.visualization.HeatmapLayer({
          data: new google.maps.MVCArray(points)
      });

      heatmap.setMap(map);

      channel.bind('login', function(data) {
        var geo = data.geo;

        console.log(points.length)
        points.push(new google.maps.LatLng(geo.lat, geo.lng));
        heatmap.setMap(map);
      });
      }

    google.maps.event.addDomListener(window, 'load', initialize);
    </script>
  </head>
  <body>
    <div id="map-canvas"></div>
  </body>
</html>
